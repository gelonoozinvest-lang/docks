Техническое задание: Router AI Agents (Обобщённая версия)
1. Цель
Создать модуль Router AI Agents, выполняющий интеллектуальную маршрутизацию задач между агентами фабрики разработки. Роутер принимает задачи, классифицирует их, выбирает подходящего агента, передаёт задачу на исполнение, контролирует процесс, сохраняет результаты в RAG-БД и возвращает итог инициатору.

2. Основные функции роутера
2.1. Приём задач
Роутер обеспечивает единую точку входа для задач из различных источников:

Сценарии n8n.
REST API.
Клиентский кабинет (UI).
Запросы от других AI-агентов.
Системные триггеры (CRON, события).
2.2. Классификация задач
Модуль анализа входящего запроса определяет:

Тип задачи.
Требуемую специализацию агента.
Необходимость загрузки контекста из RAG.
Потребность в подключении внешних сервисов.
2.3. Маршрутизация задач
Алгоритм выбора исполнителя базируется на:

Данных из Excel-реестра агентов.
Типе задачи и соответствии доступных n8n-модулей.
Системных настройках и приоритетах выполнения.
2.4. Управление выполнением
Роутер выступает оркестратором:

Передает задачу выбранному агенту.
Ожидает завершения выполнения.
Обрабатывает ошибки (перезапуск, эскалация).
Сохраняет финальный результат в RAG-БД.
3. Логирование
Все этапы жизненного цикла задачи сохраняются в базе данных RAG-сервиса:

Тело входящей задачи.
Логика маршрутизации (почему выбран конкретный агент).
Ответы агентов.
Ошибки и исключения.
Метаданные (время выполнения, токены и т.д.).
4. Интеграция с RAG-сервисом
Двустороннее взаимодействие с базой знаний:

Запрос контекста: Обогащение задачи историческими данными перед отправкой агенту.
Обновление знаний: Сохранение успешных результатов для использования в будущем.
5. Excel-реестр агентов
Конфигурация агентов управляется через таблицу, содержащую следующие поля:

agent_id — Уникальный идентификатор.
agent_name — Читаемое имя.
agent_type — Тип/специализация.
system_settings — Системные промпты и настройки.
n8n_modules — Ссылки на используемые вебхуки/модули n8n.
rag_access — Уровень доступа к базе знаний.
priority — Вес агента при выборе.
enabled — Флаг активности (True/False).
description — Описание для классификатора.
6. Поддерживаемые сервисы и стек
ML-платформы: OpenAI, HuggingFace, Anthropic, Gemini, локальные LLM.
Облака: Cloudflare, AWS, GCP.
Инфраструктура: Terraform CLI, Vault, n8n.
Контекст и БД: RAG Service, Vector DB.
7. Архитектура роутера
7.1. Компоненты системы
Router Core — Ядро системы.
Task Classifier — Модуль анализа намерений.
Agent Selector — Модуль выбора исполнителя.
Excel Registry Loader — Загрузчик конфигураций.
RAG Connector — Интерфейс к базе знаний.
n8n Connector — Интерфейс к n8n.
Execution Controller — Контроль исполнения.
Error Handler — Обработчик ошибок.
Logging Layer — Слой логирования.
7.2. Диаграмма компонентов (Component Diagram)
                +-----------------------+
                |      Task Source      |
                | n8n / API / UI / Sys  |
                +-----------+-----------+
                            |
                            v
                +-----------------------+
                |      Router Core      |
                +-----------+-----------+
                            |
        +-------------------+-------------------+
        |                   |                   |
        v                   v                   v
+---------------+   +---------------+   +----------------+
| Task          |   | Agent         |   | Excel Registry |
| Classifier    |   | Selector      |   | Loader         |
+-------+-------+   +-------+-------+   +--------+-------+
        |                   |                    |
        +---------+---------+                    |
                  |                              |
                  v                              v
        +-----------------------+       +-----------------------+
        |     n8n Connector     |       |     RAG Connector     |
        +-----------+-----------+       +-----------+-----------+
                    |                               |
                    v                               v
        +-----------------------+       +-----------------------+
        |  Execution Controller |       |     Logging Layer     |
        +-----------+-----------+       +-----------+-----------+
                    |                               |
                    v                               v
        +-----------------------+       +-----------------------+
        |         Agent         |       |      RAG Database     |
        +-----------------------+       +-----------------------+
7.3. Диаграмма последовательности (Sequence Diagram)
sequenceDiagram
    participant User as Пользователь/Система
    participant Router as Router Core
    participant Classifier as Task Classifier
    participant AgentSelector as Agent Selector
    participant RAG as RAG Service
    participant Agent as Исполнитель (Agent)

    User->>Router: Отправка задачи
    Router->>Classifier: Классифицировать задачу
    Classifier-->>Router: Тип задачи
    Router->>AgentSelector: Выбрать агента (на основе Excel)
    AgentSelector-->>Router: Агент выбран
    Router->>RAG: Запрос контекста (если нужно)
    RAG-->>Router: Контекст
    Router->>Agent: Передать задачу + Контекст
    Agent-->>Router: Результат выполнения
    Router->>RAG: Сохранить результат и логи
    Router->>User: Вернуть результат
8. Результат
Фабрика разработки получает централизованный управляющий слой (Router AI Agents), который:

Автоматически распределяет поток задач.
Гибко управляется через Excel-реестр (без изменения кода).
Использует RAG как динамическую базу знаний.
Обеспечивает прозрачное логирование и интеграцию с внешними сервисами.
