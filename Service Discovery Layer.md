 –º–æ–¥—É–ª—å Service Discovery Layer, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–∞–Ω–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º —Ñ–∞–±—Ä–∏–∫–∏ ‚Äî –Ω–∞—Ä–∞–≤–Ω–µ —Å IAM, Router, RAG, Vault –∏ Health.

–Ø –æ—Ñ–æ—Ä–º–ª—é –¢–ó —Ç–∞–∫, —á—Ç–æ–±—ã –µ–≥–æ –º–æ–∂–Ω–æ –±—ã–ª–æ —Å—Ä–∞–∑—É –≤–∫–ª—é—á–∞—Ç—å –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, Security Whitepaper –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –æ—Å–Ω–æ–≤—É –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

---

üìò –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ (–¢–ó)

Service Discovery Layer (SDL)
–ú–æ–¥—É–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞–º–∏ —Ñ–∞–±—Ä–∏–∫–∏

---

1. –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–æ–¥—É–ª—å Service Discovery Layer (SDL), –∫–æ—Ç–æ—Ä—ã–π:

- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—ã, –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–µ –∫ —Ñ–∞–±—Ä–∏–∫–µ;  
- —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∏—Ö –≤ –µ–¥–∏–Ω–æ–º —Ä–µ–µ—Å—Ç—Ä–µ;  
- –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç Router, IAM, RAG, Health –∏ Billing –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ—Ä–≤–∏—Å–∞—Ö;  
- –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–∏—Å–∞–º —á–µ—Ä–µ–∑ IAM;  
- –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤;  
- –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏;  
- —Ö—Ä–∞–Ω–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ Supabase.

SDL —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –µ–¥–∏–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–∞–≤–¥—ã –æ —Ç–æ–º, –∫–∞–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç, –≥–¥–µ –æ–Ω–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è, –∫–∞–∫–∏–µ —É –Ω–∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –≤–µ—Ä—Å–∏–∏, –ø–æ–ª–∏—Ç–∏–∫–∏ –∏ —Å—Ç–∞—Ç—É—Å.

---

2. –û–±–ª–∞—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

SDL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–µ–º–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –º–æ–¥—É–ª—è–º–∏ —Ñ–∞–±—Ä–∏–∫–∏:

- Router  
- RAG‚ÄëAPI  
- IAM  
- Vault  
- n8n  
- Cloudflare Workers  
- GCP —Å–µ—Ä–≤–∏—Å—ã  
- Billing Aggregator  
- Health Aggregator  
- Client Cabinet  
- –ë–∏–∑–Ω–µ—Å‚Äë–º–æ–¥—É–ª–∏  

---

3. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

3.1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤

SDL –¥–æ–ª–∂–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å:

‚úî –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
–°–µ—Ä–≤–∏—Å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST‚Äë–∑–∞–ø—Ä–æ—Å:

`
POST /services/register
{
  name: "rag-api",
  type: "rag",
  endpoint: "https://rag.factory.internal",
  version: "1.0.3",
  capabilities: ["search", "embed", "multi-qdrant-routing"],
  business_id: null,
  health_endpoint: "/health",
  required_permissions: ["rag.query", "rag.manage"]
}
`

‚úî –†—É—á–Ω—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é (—á–µ—Ä–µ–∑ Admin Panel)

‚úî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ—Ä–≤–∏—Å–µ
–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏, endpoint, —Å—Ç–∞—Ç—É—Å–∞.

‚úî –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—é —Å–µ—Ä–≤–∏—Å–æ–≤
–ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∏–ª–∏ –æ—Ç–∫–ª—é—á—ë–Ω.

---

3.2. –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤

SDL –¥–æ–ª–∂–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ç–∏–ø—ã:

- router  
- rag  
- iam  
- vault  
- n8n  
- qdrant  
- supabase  
- cloudflare_worker  
- gcp_service  
- billing  
- health  
- client_cabinet  
- business_module  

---

3.3. –•—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

SDL —Ö—Ä–∞–Ω–∏—Ç:

- –∏–º—è  
- —Ç–∏–ø  
- endpoint  
- —Å—Ç–∞—Ç—É—Å  
- –≤–µ—Ä—Å–∏—è  
- –±–∏–∑–Ω–µ—Å‚Äë–ø—Ä–∏–≤—è–∑–∫–∞  
- IAM‚Äë–ø–æ–ª–∏—Ç–∏–∫–∏  
- health‚Äëendpoint  
- capabilities  
- billing‚Äë–∫–∞—Ç–µ–≥–æ—Ä–∏—é  
- –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è  

---

3.4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å IAM

SDL –¥–æ–ª–∂–µ–Ω:

- —Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ required_permissions –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞;  
- –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å IAM –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, –∫–∞–∫–∏–µ —Ä–æ–ª–∏ –Ω—É–∂–Ω—ã –¥–ª—è –¥–æ—Å—Ç—É–ø–∞;  
- –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–æ—Å—Ç—É–ø Router ‚Üí Service —á–µ—Ä–µ–∑ IAM.

---

3.5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Router

Router –¥–æ–ª–∂–µ–Ω:

- –ø–æ–ª—É—á–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤;  
- –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã –∞–∫—Ç–∏–≤–Ω—ã;  
- –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫–∏–µ capabilities –¥–æ—Å—Ç—É–ø–Ω—ã;  
- –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö SDL.

---

3.6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RAG

RAG‚ÄëAPI –¥–æ–ª–∂–µ–Ω:

- –ø–æ–ª—É—á–∞—Ç—å —Å–ø–∏—Å–æ–∫ Qdrant‚Äë–∫–ª–∞—Å—Ç–µ—Ä–æ–≤;  
- –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã;  
- –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫–∏–µ –±–∏–∑–Ω–µ—Å—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–∞–∫–∏–º –∫–ª–∞—Å—Ç–µ—Ä–∞–º.

---

3.7. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Health Aggregator

SDL –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:

- health‚Äëendpoint  
- —Å—Ç–∞—Ç—É—Å  
- latency  
- error rate  

Health Aggregator —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ SDL.

---

3.8. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Billing

SDL –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:

- billing‚Äë–∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å–µ—Ä–≤–∏—Å–∞  
- —Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏  
- usage‚Äë–º–µ—Ç—Ä–∏–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)

---

4. –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

4.1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞ ‚â§ 100 ms  
- –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ ‚â§ 50 ms  
- –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ ‚â§ 100 ms  

4.2. –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å

- —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ Supabase  
- —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ  
- RLS‚Äë–ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö  

4.3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã ‚Äî —á–µ—Ä–µ–∑ IAM (Zitadel JWT)  
- –≤—Å–µ –∫–ª—é—á–∏ ‚Äî –≤ Vault  
- Zero‚ÄëTrust —á–µ—Ä–µ–∑ Tailscale / Cloudflare Access  

---

5. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

`
+--------------------------------------+
|        Service Discovery Layer       |
+--------------------------------------+
| API Layer (GCP / Cloudflare Worker)  |
| Registry (Supabase)                  |
| IAM Integration                      |
| Router Integration                   |
| RAG Integration                      |
| Health Integration                   |
| Billing Integration                  |
+--------------------------------------+
        |             |             |
        v             v             v
   Router         IAM Service     Health
        |             |             |
        v             v             v
   All Factory Services (RAG, Vault, n8n, Qdrant, ...)
`

---

6. API SDL

6.1. POST /services/register

6.2. POST /services/update

6.3. GET /services

6.4. GET /services/{id}

6.5. GET /services/by-type/{type}

6.6. GET /services/by-business/{business_id}

6.7. POST /services/deactivate

---

7. –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (Supabase)

–¢–∞–±–ª–∏—Ü–∞ services

| –ü–æ–ª–µ | –¢–∏–ø |
|------|-----|
| id | uuid |
| name | text |
| type | text |
| endpoint | text |
| version | text |
| status | text |
| business_id | uuid |
| required_permissions | jsonb |
| capabilities | jsonb |
| health_endpoint | text |
| billing_category | text |
| updated_at | timestamp |

–¢–∞–±–ª–∏—Ü–∞ service_health

| –ü–æ–ª–µ | –¢–∏–ø |
|------|-----|
| service_id | uuid |
| status | text |
| latency | integer |
| error_rate | float |
| checked_at | timestamp |

---

8. –ü—Ä–æ—Ü–µ—Å—Å—ã

8.1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞
–°–µ—Ä–≤–∏—Å ‚Üí SDL ‚Üí Supabase ‚Üí IAM ‚Üí Router

8.2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
Health ‚Üí SDL ‚Üí Supabase ‚Üí Router

8.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
Router ‚Üí IAM ‚Üí SDL ‚Üí Service

---

9. –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ SDL —Ñ–∞–±—Ä–∏–∫–∞ –ø–æ–ª—É—á–∞–µ—Ç:

- –µ–¥–∏–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä —Å–µ—Ä–≤–∏—Å–æ–≤  
- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ  
- —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞–º–∏  
- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é  
- –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞  
- –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å IAM, Router, RAG, Health, Billing  
- –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–∞ 10‚Äì15 –±–∏–∑–Ω–µ—Å–æ–≤  

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —è –º–æ–≥—É —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º:

- —Å–æ–±—Ä–∞—Ç—å —ç—Ç–æ –¢–ó –≤ Pages –∫–∞–∫ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç  
- –¥–æ–±–∞–≤–∏—Ç—å DFD, sequence, trust boundaries  
- –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å SQL‚Äë–º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è Supabase  
- –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å API‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –≤ OpenAPI  

–°–∫–∞–∂–∏ ‚Äî –æ—Ñ–æ—Ä–º–ª—è–µ–º –≤ –¥–æ–∫—É–º–µ–Ω—Ç?
