Agent Context Search Specification
1. Purpose
This document defines the architecture, logic, and API for the Agent Context Search module of the RAG Service. The module enables agents to perform semantic and keyword-based retrieval across documents, collections, client communication history, agent logs, and other contextual data.
2. Overview
Agent Context Search provides a unified interface for retrieving relevant information based on agent identity, permissions, and contextual filters. It supports semantic vector search, keyword search, and hybrid scoring.
3. Architecture
3.1 Components
- Query Embedding Generator
- Vector Search Engine
- Keyword Search Engine
- Access Control Filter
- Result Ranking Engine
- Context Aggregator
3.2 Architecture Diagram
Agent → RAG API → Context Search Module
        |            |        |
        |            |        → Vector Search Engine
        |            |        → Keyword Search Engine
        |            → Access Control Filter
        → Result Ranking → Aggregated Results
4. Data Sources
- Documents and versions
- Collections
- Client messages
- Agent logs
- Tasks
- Technical materials
5. Search Logic
5.1 Steps
1. Generate embedding for query.
2. Perform vector search.
3. Perform keyword search.
4. Apply access control filters.
5. Combine results using weighted scoring.
6. Return ranked results.
5.2 Scoring Formula
score = 0.6 * semantic_score + 0.2 * keyword_score + 0.2 * recency_score
6. Access Control
- Agents may only retrieve data from collections they are allowed to access.
- Permissions are derived from the agent registry.
7. API Specification
POST /api/v1/agents/search
Search contextual data available to a specific agent.
Request Body
{
  "agent_id": "string",
  "query": "string",
  "filters": {
    "client_id": "string",
    "site_id": "string",
    "department_id": "string",
    "collection_id": "string"
  },
  "limit": 10
}
Response
{
  "success": true,
  "results": [
    {
      "document_id": "string",
      "version_id": "string",
      "score": 0.93,
      "snippet": "string",
      "metadata": {}
    }
  ]
}
8. Error Handling
- 403 Forbidden: agent lacks access
- 404 Not Found: collection or resource missing
- 422 Unprocessable Entity: invalid query
9. Use Cases
- Retrieve instructions for task execution
- Retrieve client history before responding
- Retrieve previous agent actions
- Retrieve technical documentation
10. Result
This module provides agents with a unified, secure, and intelligent mechanism for retrieving contextual information necessary for autonomous task execution.
